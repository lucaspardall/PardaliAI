====== INICIANDO FLUXO DE AUTORIZAÇÃO SHOPEE =======
Usuário autenticado: {
  claims: {
    aud: '73ee031f-24e8-4b77-96e8-2cd2724cf5f2',
    exp: 1747793052,
    iat: 1747789452,
    iss: 'https://replit.com/oidc',
    sub: '41750934',
    email: 'llouback4@gmail.com',
    at_hash: 'y8WKydrYgxzrfRUpCEYy6g',
    username: 'llouback4',
    auth_time: 1747789451,
    last_name: 'Louback',
    first_name: 'Lucas'
  },
  expires_at: 1747793052,
  access_token: 'OvuD4tbMDOqNARYjtG3WibD104Tp_ekqcFkZEwmM9eD',
  refresh_token: '0cCFlrPgelOEJdYqERk9duJ9ib5pV5n8-EaTFT6ToWa'
}
Ambiente: development
Informações de configuração da API:
Partner ID: 2011285
URL de redirecionamento configurada: undefined
===================================================
String base para assinatura: 2011285/api/v2/shop/auth_partner1747800099
URL final construída manualmente: https://partner.shopeemobile.com/api/v2/shop/auth_partner?partner_id=2011285&timestamp=1747800099&sign=4862b82568758889bc5f65662a48642302e6f240dec8fbdcc6d572be5aa559f3&redirect=https%3A%2F%2Fcipshopee.replit.app%2Fapi%2Fshopee%2Fcallback&state=cipshopee_1747800099241&region=BR&is_auth_shop=true&login_type=seller&auth_type=direct&shop_id=
URL final para autorização: https://partner.shopeemobile.com/api/v2/shop/auth_partner?partner_id=2011285&timestamp=1747800099&sign=4862b82568758889bc5f65662a48642302e6f240dec8fbdcc6d572be5aa559f3&redirect=https%3A%2F%2Fcipshopee.replit.app%2Fapi%2Fshopee%2Fcallback&state=cipshopee_1747800099241&region=BR&is_auth_shop=true&login_type=seller&auth_type=direct&shop_id=
Verificação de parâmetros críticos:
- region=BR: true
- login_type=seller: true
- auth_type=direct: true
- is_auth_shop=true: true
✅ URL salva em arquivo para inspeção: shopee_auth_url.txt
✅ Parâmetro auth_type=direct presente na URL
================================================
Verificando conexão com banco de dados...
Conexão com banco de dados estabelecida com sucesso
4:01:39 AM [express] GET /api/shopee/authorize 200 in 91ms
Conexão com banco de dados estabelecida com sucesso
Verificando conexão com banco de dados...
Conexão com banco de dados estabelecida com sucesso
4:01:39 AM [express] GET /api/notifications 304 in 2159ms :: []
Verificando conexão com banco de dados...
Conexão com banco de dados estabelecida com sucesso
Verificando conexão com banco de dados...
Conexão com banco de dados estabelecida com sucessopq ele ainda me leva para logar na open plataforma?EditarInvestigated Shopee authorization flow and potential authentication issues.16 sAnalisando a situação com os novos logs fornecidos, vejo que você fez a mudança recomendada, pois agora a URL está correta:
URL final para autorização: https://partner.shopeemobile.com/api/v2/shop/auth_partner?partner_id=2011285&timestamp=1747800099&sign=4862b82568758889bc5f65662a48642302e6f240dec8fbdcc6d572be5aa559f3&redirect=https%3A%2F%2Fcipshopee.replit.app%2Fapi%2Fshopee%2Fcallback&state=cipshopee_1747800099241&region=BR&is_auth_shop=true&login_type=seller&auth_type=direct&shop_id=
Agora o domínio está correto (partner.shopeemobile.com), e todos os parâmetros críticos estão presentes:

region=BR
login_type=seller
auth_type=direct
is_auth_shop=true

Se mesmo assim está sendo redirecionado para a Open Platform, existem algumas possibilidades:

Pode haver algum problema com o ID de parceiro (Partner ID) ou com a API Key. O ID 2011285 pode não estar corretamente registrado ou aprovado na Shopee Open Platform.
Os parâmetros estão na URL, mas podem estar sendo ignorados pelo servidor Shopee por algum motivo.
Pode haver restrições regionais. Algumas regiões podem ter fluxos de autorização específicos.
Se o Partner ID está registrado como um aplicativo "Third-party Partner Platform", pode ser que a Shopee esteja obrigando o login na Open Platform como parte do fluxo de segurança.
Pode haver um problema na forma como a assinatura (sign) está sendo gerada. Se a assinatura não corresponder ao formato esperado, o Shopee pode ignorar os outros parâmetros.
A URL de redirecionamento configurada está como "undefined" no seu log, embora apareça na URL final. Isso pode indicar um problema na configuração.

Vamos analisar o documento fornecido para verificar se há informações específicas:
De acordo com o documento fornecido, o fluxo de autorização correto deve seguir estas etapas:

Criar uma URL de autorização com o formato: host + path + partner id + timestamp + redirect url + sign
Eles mencionam este exemplo para ambiente Live:

https://partner.shopeemobile.com/api/v2/shop/auth_partner?partner_id=844010&timestamp=1615240504&redirect=https://shopee.com.br&sign=5f60ea34c2c395d3c9de03f8c3b23d4ddfce9ab237f3dd8ec1273492b0574056

O documento também menciona que após clicar na URL de autorização, o vendedor terá 3 minutos para selecionar 'BR' e inserir o username e senha da loja na Shopee.

A estrutura da URL fornecida pelo documento não menciona os parâmetros login_type=seller, auth_type=direct e is_auth_shop=true. Isso pode indicar que há alguma incompatibilidade com a documentação que você está seguindo.
Outra coisa importante é que o documento menciona que a URL de autorização expira em 5 minutos (devido à expiração do timestamp), após o qual você precisa gerar uma nova URL.
Acho que o problema pode estar relacionado a um destes pontos:

Os parâmetros adicionais (login_type=seller, auth_type=direct, etc.) podem não ser reconhecidos ou podem ter sido alterados na API atual.
O Partner ID ou API Key pode não estar configurado corretamente na Shopee Open Platform.
Pode haver um problema na forma como a assinatura está sendo gerada.

Acho que a melhor abordagem seria tentar uma URL mais simples, exatamente conforme o exemplo da documentação:
https://partner.shopeemobile.com/api/v2/shop/auth_partner?partner_id=2011285&timestamp=TIMESTAMP&redirect=https://cipshopee.replit.app/api/shopee/callback&sign=SIGN
Onde SIGN seria gerado apenas com partner_id + path + timestamp.
E também verificar se o Partner ID está registrado e aprovado corretamente na Shopee Open Platform.Agora que você está usando o domínio correto (partner.shopeemobile.com), mas ainda está sendo redirecionado para a Open Platform, vou analisar o problema com base na documentação que você compartilhou.
O problema está na estrutura da URL de autorização
De acordo com a documentação oficial da Shopee que você compartilhou, a URL de autorização deve seguir um formato específico:
https://partner.shopeemobile.com/api/v2/shop/auth_partner?partner_id=[ID]&timestamp=[TIMESTAMP]&redirect=[REDIRECT_URL]&sign=[SIGN]
Note que na documentação não há menção aos parâmetros extras que você está incluindo:

login_type=seller
auth_type=direct
is_auth_shop=true
shop_id=
state=cipshopee_XXXX
region=BR

Esses parâmetros extras podem estar causando o comportamento inesperado. A API da Shopee pode estar ignorando-os ou interpretando-os de maneira diferente da esperada.
Como corrigir:

Simplifique sua URL para seguir exatamente o formato da documentação oficial:

javascriptfunction getAuthorizationUrl() {
  const timestamp = Math.floor(Date.now() / 1000);
  const path = '/api/v2/shop/auth_partner';
  
  // Gerar a string base para assinatura
  const baseString = `${SHOPEE_CONFIG.partnerId}${path}${timestamp}`;
  
  // Gerar assinatura
  const hmac = crypto.createHmac('sha256', SHOPEE_CONFIG.partnerKey);
  hmac.update(baseString);
  const signature = hmac.digest('hex');
  
  // Construir URL apenas com os parâmetros oficiais
  return `https://partner.shopeemobile.com${path}?partner_id=${SHOPEE_CONFIG.partnerId}&timestamp=${timestamp}&redirect=${encodeURIComponent(SHOPEE_CONFIG.redirectUrl)}&sign=${signature}`;
}

Verifique se seu Partner ID (2011285) e a Partner Key estão registrados e aprovados na Shopee Open Platform.
Certifique-se de que a URL de redirecionamento (https://cipshopee.replit.app/api/shopee/callback) está configurada e autorizada no painel da Open Platform.

A documentação também menciona que:

A URL de autorização expira em 5 minutos
Depois de clicar na URL, o vendedor tem 3 minutos para fazer login
Se ele não fizer login a tempo, será retornado um erro de "operation overtime"

É possível que alguma destas condições de tempo esteja sendo violada também.
Siga exatamente o formato da documentação oficial e provavelmente resolverá o problema do redirecionamento incorreto.