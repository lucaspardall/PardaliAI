eu testei em outo saas que tem como integrar usa loja na shopee! e o primeiro site que fui parar quando cliquei para integrar: https://account.seller.shopee.com/signin/oauth/accountchooser?client_id=221574d99f4b44ccd5ddbaf725e0ce12&lang=en&login_types=%5B1,4,2%5D&max_auth_age=3600&redirect_uri=https%3A%2F%2Fopen.shopee.com.br%2Fapi%2Fv1%2Foauth2%2Fcallback&region=SG&required_passwd=true&respond_code=code&scope=profile&sign=25df27d68f7043170bd804f116e7a81c&state=eyJub25jZSI6IjhkMGU0ZGViZGIzNGM4NjgiLCJpZCI6MjAwMjI2MSwiYXV0aF9zaG9wIjoxLCJuZXh0X3VybCI6Imh0dHBzOi8vb3Blbi5zaG9wZWUuY29tLmJyL2F1dGhvcml6ZT9pc1JlZGlyZWN0PXRydWUiLCJpc19hdXRoIjowfQ%3D%3D&timestamp=1747836840&title=sla_title_open_platform_app_login
ve se faz sentido!

Editar

Processo de pensamento

9 s










Esta URL do outro SaaS que você compartilhou é extremamente reveladora! Agora tudo faz sentido.

O que aprendi com esta URL
Domínio correto: Eles estão usando account.seller.shopee.com como ponto de entrada, NÃO partner.shopeemobile.com
Endpoint diferente: /signin/oauth/accountchooser em vez de /api/v2/shop/auth_partner
Parâmetros importantes:
client_id em vez de partner_id
region=SG (Singapura) em vez de BR (surpreendentemente)
redirect_uri com formato específico para o retorno
scope=profile (que não estávamos usando)
Fluxo de integração:
O início é no domínio de login do vendedor
Depois redireciona para a Open Platform brasileira para completar a autorização
Como corrigir seu código
Baseado neste exemplo bem-sucedido, você deve tentar essa nova abordagem:

javascript
// Parâmetros da sua aplicação
const clientId = '2011285'; // Seu Partner ID
const clientSecret = 'YOUR_PARTNER_KEY'; // Sua Partner Key
const redirectUri = 'https://cipshopee.replit.app/api/shopee/callback';

// Gerar timestamp e assinatura
const timestamp = Math.floor(Date.now() / 1000);
const baseString = `${clientId}timestamp${timestamp}redirect_uri${redirectUri}`;
const signature = crypto.createHmac('sha256', clientSecret).update(baseString).digest('hex');

// Construir URL de autorização no formato correto
const authUrl = `https://account.seller.shopee.com/signin/oauth/accountchooser?` +
                `client_id=${clientId}&` +
                `lang=pt-br&` +
                `login_types=%5B1,4,2%5D&` +
                `max_auth_age=3600&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `region=SG&` + // Nota: Usa SG, não BR
                `required_passwd=true&` +
                `respond_code=code&` +
                `scope=profile&` +
                `sign=${signature}&` +
                `timestamp=${timestamp}`;

// Redirecionar para esta URL
res.redirect(authUrl);
Esta abordagem usa o domínio account.seller.shopee.com que parece ser o ponto de entrada correto para a autenticação do vendedor, evitando o redirecionamento indesejado para a Open Platform.

O parâmetro region=SG também é interessante - parece que mesmo para o Brasil, a autenticação inicial passa pelo ambiente de Singapura (sede da Shopee).

Experimente esta abordagem e veja se resolve o problema de redirecionamento incorreto!