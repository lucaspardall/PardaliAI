Chamadas de API
Última atualização: 2022-10-10
Idioma suportado: Inglês / 简体中文 / 繁體中文 / Português
⚠️ Lembrete : Esse passo a passo só se aplica às chamadas do OpenAPI v2.0.

Ambientes de API


Atualmente temos dois ambientes para APIs para desenvolvedores locais:

Ambiente de produção
https://partner.shopeemobile.com/ 
Ambiente de teste sandbox:
https://partner.test-stable.shopeemobile.com/


Selecione o ambiente com base nos servidores locais de onde você está acessando a plataforma de API.

Métodos de chamadas de API


Atualmente, a plataforma OpenAPI só tem dois métodos de proteção: GET e POST.



Parâmetros de chamadas na API


No documento da API, você verá dois tipos de parâmetros:

Parâmetro comum
Parâmetro de solicitação


URL de autorização fixa:GET , essas duas configurações podem existir ao mesmo tempo, ou apenas o parâmetro Common vai existir.



https://partner.shopeemobile.com/api/v2/shop/auth_partnerPOST , as duas configurações existirão ao mesmo tempo.




Ambiente de teste sandbox:

Parâmetros	Descrição
ID do parceiro	Todas as chamadas de API precisam de um ID de parceiro. Você pode obter o ID do parceiro criando um aplicativo na página Shopee Open Platform > Console App . O ID de parceiro de teste só pode ser usado no ambiente de testes, e o ID de parceiro ao vivo só pode ser usado no ambiente de produção.
carimbo de data/hora	Todas as chamadas de API precisam de  timestamps (marcação de horário).Exemplo de carimbo de data/hora: 1610000000.Cada solicitação para a API deve ser feita em até 5 minutos após o horário do carimbo de data/hora.
sinal	Todas as chamadas de APIs precisam de uma assinatura gerada usando o algoritmo SHA256. Diferentes tipos de API têm métodos de criação de assinatura diferentes. Para detalhes, por favor, verifique a seção maior do Cálculo de Assinaturas deste artigo.
token de acesso	Tokens de acesso são necessários para obter e modificar APIs relacionadas aos dados dos vendedores. Cada token de acesso é válido por 4 horas e pode ser reutilizado dentro de um período de validade. O token de acesso precisa ser atualizado periodicamente. Confira o artigo sobre Autorização e Autenticação para saber mais sobre como obter e recarregar seus tokens.
id_da_loja	O ID de identificação exclusivo de uma loja no Shopee que pode ser obtido quando uma loja concede autorização. Verifique o artigo sobre autorização e autenticação para saber como obter o ID de uma loja.
id_do_comerciante	O documento de identificação exclusivo de um vendedor do Shopee pode ser obtido depois que o vendedor concede a autorização. A Open API só aceita vendedores internacionais para o uso de um ID de vendedor. Confira o artigo sobre Autorização e Autenticação para saber como obter um ID de vendedor.
Tipos de API aberta


Nenhum documento de API existe 3 tipos, por conta das diferentes parâmetros comuns. As configurações públicas existentes são:

API da loja: ID do parceiro, carimbo de data/hora, sinal, token de acesso, ID da loja
API Marchant: ID do parceiro, carimbo de data/hora, sinal, token de acesso, ID do comerciante
API pública: partner_id, timestamp, sign


Calculando o sinal do parâmetroLembrete: Itens em vermelho estão destacados para indicar que são diferentes tipos de APIs Puclic.



As APIs públicas não precisam de token de acesso, enquanto as APIs de loja e de comerciante precisam. Isso significa que as Shop APIs e o Merchant só podem receber chamadas depois que a loja conceder autorização.



Existem 3 tipos de APIs que requerem o uso de parâmetros diferentes para criar o sign base string. (consistente com suas configurações comuns).



Cálculo de Assinatura


Passo 1: Criar uma string base:

Diferentes tipos de APIs têm elementos diferentes na string base. Você precisa concatenar o caminho da API (sem host) e os seguintes parâmetros comuns em uma string única. Você precisa seguir a sequência (base string) como está descrito abaixo:



Utilize o algoritmo HMAC-SHA256 para fazer o hash da string de base do sign, e use o parceiro test_key como chave de criptografia. O valor hexadecimal em letras minúsculas do hash é uma assinatura de autenticação.



Demonstração de código Python: partner_id, caminho da API, registro de data e hora, token de acesso, shop_id

*Exemplo：ID do parceiro, caminho da API, registro de data e hora, token de acesso, ID da loja

*Exemplo：

Caminho da API: /api/v2/shop/get_shop_info

Caminho da API: /api/v2/shop/get_shop_info

token de acesso: 59777174636562737266615546704c6d

token de acesso: 59777174636562737266615546704c6d



Exemplos de links de autorização:



Ambiente de Produção:partner_id, caminho da API, registro de data e hora, token de acesso, merchant_id

API do comerciante:

ID do parceiro: 2001887

ID do parceiro: 2001887

Caminho da API: /api/v2/global_product/get_category

token de acesso: 09777174636962737266615546704c6d

token de acesso: 09777174636962737266615546704c6d



O vendedor pode usar a conta da loja



1. O vendedor preencha as informações e faça Login .

*Exemplo:partner_id, caminho da API, registro de data e hora

*Exemplo:Verificar .

Caminho da API: /api/v2/public/get_shops_by_partner

Caminho da API: /api/v2/public/get_shops_by_partnerConfirmar autorização .



4. Após a autorização, o front-end será direcionado para a URL de redirecionamento no seu link de autorização:



Passo 2: Calcular a assinatura usando o algoritmo HMAC-SHA256



Faça o design da assinatura usando o algoritmo HMAC-SHA256 na string base e na chave do parceiro (obtida por meio da página de informações do app Shopee Open Platform ). O resultado do cálculo é uma string codificada em hexadecimal.



*Exemplo：

*Exemplo：



4. erro de "Sinal errado"Confirmar Autorização



Exemplo de código:

Pitão
#!/usr/bin/envpython

# encoding:utf-8



import hmac 

import time

import requests

import hashlib

timest=int(time.time())

host="https://partner.shopeemobile.com 

access_token = "random string"



partner id =80001

partner key = "test....."



#### call shop level api 

shop id =209920

base string ="%s%s%s%s%s"%(partner id, path timest access token, shop id) 

sign = hmac.new( partner key,base string,hashlib.sha256)hexdigest() 

path ="/api/v2/example/shop level/get"



url = host + path + "?partner_id=%s&shop_id=%s&timestamp=%s&access_token=%s&sign=%s"%(partner_id, shop_id, timest, access_token, sign) 

headers={"Content-Type":"application/ison"? 

resp=requests.post(urlheaders=headers)



#### call merchant level api 

merchant id =1234567

base string ="%s%s%s%s%s"%(partner id, path timest, access token, merchant id) 

sign =hmac.new( partner key,base string,hashlib.sha256).hexdigest() 

path ="/api/v2/example/merchant_level/get"



url = host+ path +"?partner id=%s&merchant id=%s&timestamp=%s&access token=%s&sign=%s"%(partnerid, merchant id, timest, access token, sign) 

headers ={"Content-Type":"application/ison"? resp =requests.eet(urlheaders=headers)



#### call public api

base string ="%s%s%5%s"%(partner idpathtimestaccess token)

sign= hmac.new( partner keybase stringhashlib.sha256)hexdigest() 

path ="/api/v2/auth merchant/access token/get"



url = host+path+"?partner id=%s&timestamp=%s&sign=%s%(partner idtimest, sign)

body ={"partner id":partner id, "merchant id": merchant id,"refresh token":"testingtoken") 

headers =["Content-Type":"application/ison"?

resp =requests.post(url,json=bodyheaders=headers)
Modelo de chamadas para API


Para transações em APIs do tipo GET , você precisa colocar os Reques Parameter e Common Parameterstda solicitação na URL.



Exemplo: V2.product.get_category



Se a autorização foi feita com a

https://partner.shopeemobile.com/api/v2/product/get_category?partner_id=851249×tamp=1654673582&shop_id=1001094&access_token=367a0a8eb9d1837cbf7c43b587a0faa4&sign=a40fc50a08c382eeee08e2eb00deb8464c6fdcbe4f1c271e033cdbca3ded4d5b&language=zh-hans



*Para esse endpoint da API，partner_id、timestamp、access_token、shop_id e sign são Parâmetros Comuns, e, idioma é um Parâmetros de Solicitação.





Após a autorização, use o código shop_id ou main_account_id na URL para fazer uma chamada para essa API. Isso permite que você tenha acesso ao shop_id, comerciante_id, access_token e refresh_token.



Caminho:v2.shop.update_profile



Ambiente de teste/Sandbox:

https://partner.shopeemobile.com/api/v2/shop/update_profile?partner_id=851249×tamp=1654673582&shop_id=1001094&access_token=367a0a8eb9d1837cbf7c43b587a0faa4&sign=80cbce8da907d5a1237711409920fc16908a9f9e01b1254ff9cc44aaf0836122





Corpo da solicitação:

Corpo da solicitação:

"logotipo da loja": "https://cf.shopee.sg/file/8424390be4677b0b3c37ce6499ce261a",

"logotipo da loja": "https://cf.shopee.sg/file/8424390be4677b0b3c37ce6499ce261a",

"nome_da_loja": "123"

"nome_da_loja": "123"



Demonstração de código Python:

Parâmetros de resposta da API (response)
Parâmetros	É preciso retornar?	Descrição
id da solicitação	Sim	Cada solicitação para a API tem um ID único. Se você tiver algum problema com a API, por favor, envie esse ID e as informações da API para receber ajuda mais rapidamente.
erro	Sim	Código de erro. Se a solicitação for bem-sucedida, o parâmetro de erro estará em branco. Se houver algum problema, o código de erro será refletido nesse campo.
mensagem	Sim	Mensagem de erro. Se a solicitação for bem-sucedida, o parâmetro estará em branco. Se houver algum problema, esse campo vai ter informações fornecidas sobre o erro.
aviso	Sim	Se a chamada para bem-sucedida mas algum dado ou parte da solicitação solicitada, a informação será refletida nesse campo
resposta	Sim	Se a solicitação for bem-sucedida, os dados correspondentes serão refletidos nesse campo.
Funções da API s
Módulo da API	Descrição da peça
Produtos	Você pode obter as seguintes informações:
Árvore de categorias dos produtos
Atributos e informações de marcas
Dados de produtos
Informações de promoção
Item Impulsivo e Lista de produtos impulsionados
Avaliações de produtos e lista de avaliações
Categorias e atributos recomendados para produtos
Marcas registradas de produtos

Você pode realizar as seguintes ações:
Criar, excluir e atualizar informações de produtos.
Loja	Você pode obter as seguintes informações:
Nome da loja
Mercado em que a loja está baseada
Tipo de loja

Você pode realizar as seguintes ações:
Atualizar informações da loja
Comerciante	*Esse módulo está disponível apenas para vendedores internacionaisObtenha informações de vendedores (nome/mercado/moeda) e uma lista de todas as lojas administradas pelo vendedor para as quais você tem autorização.
Produtos Globais	*Esse módulo está disponível apenas para vendedores internacionaisVocê pode obter as seguintes informações:
Árvore de categorias
Atributos e informações da marca
Dados de produtos globais
Listas de produtos que podem ser anunciadas apenas em alguns mercados
Lista de produtos globais publicados
Lista de produtos anunciados em mercados específicos
ID de produtos globais correspondentes a mercados específicos
Categorias e atributos recomendados para produtos globais

Você pode realizar as seguintes ações:
Criar, excluir e atualizar produtos globais
Ativar/desativar sincronização de informações de produtos globais
Publicar produtos globais
Espaço de mídia	Atualizar vídeos e imagens
Pedidos	Você pode obter as seguintes informações:
Lista de pedidos
Informações de pedidos
Lista de notas fiscais para envio
Informações de notas fiscais

Você pode realizar as seguintes ações:
Gerenciar, cancelar cancelar pedidos
Faça pedidos separados
Processar pedidos de cancelamento do vendedor
Adicionar comentários em pedidos
Atualizar e baixar notas fiscais
Logística	Você pode obter as seguintes informações:
Lista de canais logísticos da loja
Parâmetros de envio
Números e informações de rastreio
Formatos de documentos de envio, e documentos de envio
Lista de exceções da loja
Você pode realizar as seguintes ações:
Enviar pedidos / enviar pedidos em massa
Atualizar o estado da loja
Ativar/desativar canais da loja
Excluir exceções da loja
Primeira Milha	*Esse módulo está disponível apenas para vendedores internacionaisVocê pode obter as seguintes informações:
Desvincular pedidos primeira milha
Números e detalhes de reastreiro primeira milha
Detalhes de pedicure primeira milha
Documentos de envio da primeira milha
Detalhes de canais de primeira milha
Devoluções	Você pode obter as seguintes informações:
Lista de pedidos de devolução e reembolso
Informações de devolução e reembolso
Plano de devolução e reembolso

Você pode realizar as seguintes ações:
Confirmar reembolsos
Enviar disputas
Negociar reembolsos
Atualizar evidências de imagem para reembolsos
Pagamentos	Você pode obter as seguintes informações:
Faturamento de pedidos
Dados de pagamento
Dados da carteira
Lista de pedidos concluídos
Configurações de parcelamento
Lista de produtos com pagamento parcelado
Descontos	Criar, ver, atualizar e deletar promoções com desconto
Leve mais por menos	Criar, ver, atualizar e excluir ofertas de nível mais por menos
Ofertas sem combo	Criar, ver, atualizar e excluir ofertas no combo
Cupons	Criar, visualizar, atualizar e excluir vouchers
Recompensas do seguidor	Criar, ver, atualizar e excluir recompensas do seguidor
Melhores escolhas	Criar, ver, atualizar e excluir as melhores escolhas
Categorias da loja	Criar, ver, atualizar e excluir categorias da loja
Performance da loja	Obter dados sobre desempenho da loja e pontos de encontro
Público	Você pode realizar as seguintes ações:
Lista de lojas que foram autorizadas
Lista de “comerciantes” que concederam autorização
Reenviar códigos e atualizar códigos para receber tokens
Recarregar e recarregar tokens
Empurrar	Resgatar e atualizar mecânicas de push
Bater papo	*Esse módulo só está aberto para vendedores aprovados. Para pedir aprovação, você pode verificar esse FAQ .Você pode obter as seguintes informações:
Lista de bate-papos
Informações de chat
Configurações de oferta

Você pode realizar as seguintes ações:
Excluir chats
Marcar chats como não lidos
Fixar chats e desfixar
Enviar imagens no chat
Enviar mensagens automáticas e manuais
Ativar/desativar configuração de ofertas